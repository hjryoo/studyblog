---
title: "장애 감지와 안정적인 운영의 시작, 시스템 모니터링"
date: 2025-09-01 00:00:00 +0900
categories: [일상, 공부, DevOps]
tags: [monitoring, prometheus, grafana, elk, tracing, load-testing]
---

현업에서 시스템의 장애를 감지하고 안정적인 운영을 보장하기 위해 수행되는 핵심적인 활동은 바로 **모니터링(Monitoring)**입니다. 모니터링은 서버의 리소스, 애플리케이션의 동작, 사용자 요청 흐름 등 다양한 지표를 지속적으로 추적하고 분석하는 모든 과정을 포함합니다. 이 글에서는 모니터링의 중요성과 주요 구성 요소, 그리고 안정적인 서비스를 위한 부하 테스트에 대해 알아보겠습니다.

## 1. 모니터링, 왜 중요할까?

모니터링의 가장 주된 목적은 시스템의 현재 상태를 실시간으로 파악하고, 잠재적인 문제나 실제 장애 발생 시 이를 신속하게 감지하여 대응하는 것입니다.

특히 수많은 서비스가 서로 통신하는 **마이크로서비스 아키텍처(MSA)** 환경에서는 하나의 서비스 장애가 전체 시스템의 장애로 전파될 수 있습니다. 이때 Latency(지연 시간) 모니터링은 병목 구간을 찾아내고 장애 전파를 막는 데 결정적인 역할을 합니다.

또한, 새로운 기능을 배포하기 전 부하 테스트를 통해 실제 운영 환경에서의 동작을 예측하고 적절한 운영 스펙을 유추함으로써, 안정적인 서비스를 제공하는 기반을 마련할 수 있습니다.

## 2. 모니터링의 세 기둥: 메트릭, 로그, 트레이싱

모니터링 시스템은 크게 세 가지 핵심 요소로 구성됩니다. 이를 "모니터링의 세 기둥(The Three Pillars of Observability)"이라고도 부릅니다.

### ① 메트릭 (Metrics)

CPU 사용률, 메모리 점유율, HTTP 요청 수와 같이 **시간의 흐름에 따라 수치로 측정되는 데이터**입니다. 주로 대시보드 시각화 및 알림 설정에 최적화되어 있습니다.

-   **Prometheus**: 메트릭 수집 시스템의 표준으로 자리 잡은 도구입니다. `scrape_interval` 설정에 따라 주기적으로 애플리케이션의 `/metrics` 엔드포인트에서 데이터를 수집(pull)합니다.
-   **Grafana**: Prometheus가 수집한 데이터를 시각화하는 최고의 대시보드 툴입니다. HTTP 요청 수, 응답 시간 등 다양한 지표를 사용자가 보기 쉬운 차트로 만들어 시스템 상태를 한눈에 파악하게 해줍니다.

### ② 로그 (Logs)

애플리케이션에서 발생하는 모든 이벤트에 대한 **텍스트 기록**입니다. 특정 에러가 발생했을 때 상세한 원인을 분석하는 데 필수적입니다.

-   **중앙화된 로깅**: MSA 환경에서는 흩어져 있는 로그를 한곳으로 모아 분석하는 것이 중요합니다. 이를 위해 명확한 로깅 규칙을 정하고 모든 서비스가 이를 따르도록 해야 합니다.
-   **ELK Stack / OpenSearch**: 대규모 로그를 효율적으로 저장하고 빠르게 검색하기 위한 솔루션입니다. Elasticsearch(또는 AWS의 OpenSearch), Logstash, Kibana 조합이 널리 사용됩니다.
-   **로깅 지표**: 단순히 에러 로그만 보는 것이 아니라, "로그 파싱 실패율"이나 "특정 에러의 발생 빈도" 등 로그 자체에 대한 지표를 만들어 모니터링하고 알림을 설정하는 것이 중요합니다.

### ③ 트레이싱 (Tracing)

MSA 환경에서 사용자 요청이 들어왔을 때, **여러 서비스 간의 호출 흐름을 추적**하는 기술입니다. 전체 요청 경로와 각 구간에서의 지연 시간을 식별하여 병목 지점을 찾는 데 특화되어 있습니다.

-   **Jaeger / Zipkin**: 분산 트레이싱(Distributed Tracing) 데이터를 수집하고 시각화하는 대표적인 도구입니다.
-   **OpenTelemetry**: 코드를 직접 수정하여 트레이싱 데이터를 생성(instrumentation)하기 위한 표준 SDK입니다.

## 3. 현업에서는 어떻게 활용할까?

현업에서는 위에서 소개한 도구들을 통합하여 다음과 같은 노력을 기울입니다.

-   **서버 리소스 모니터링**: Latency, Disk 용량 등 기본적인 지표를 지속적으로 확인하여 자원 부족 문제를 사전에 감지합니다.
-   **헬스체커 (Health Checker)**: 서버가 정상적으로 동작하는지 확인하는 가장 기본적인 모니터링입니다. 헬스체크 실패 시 자동으로 재시작하거나 트래픽을 차단하고, 즉시 담당자에게 알림을 보냅니다.
-   **에러 감지 및 알림**: 특정 에러의 발생 빈도가 급증할 때, 의도치 않은 비즈니스 로직 오류나 잠재적인 고객 문의 증가를 예측하고 대응하기 위해 알림을 받습니다.
-   **슬랙 알림 봇 (Slack Alert Bot)**: Datadog, Grafana Alerting 등의 툴과 연동하여 장애 상황을 팀 메신저(Slack)로 전송함으로써 이슈를 빠르게 인지하고 전파합니다.
-   **통합 대시보드**: API별 요청 수, 트래픽 처리 효율, 캐시 히트율 등 다양한 지표를 Grafana 대시보드에 시각화하여 개발자뿐만 아니라 다른 직군의 동료들도 시스템 상태를 쉽게 이해하고 문제의 원인(Root Cause)을 함께 파악할 수 있도록 돕습니다.

## 4. 장애 예방의 핵심, 부하 테스트 (Load Testing)

부하 테스트는 기능을 배포하기 전에 시스템의 한계를 파악하고 운영 스펙을 검증하는 중요한 과정입니다.

#### 부하 테스트의 목적

-   **TPS (Transaction Per Second)**: 시스템이 초당 처리할 수 있는 트랜잭션의 최대치를 파악합니다.
-   **응답 시간 (Response Time)**: 부하가 증가함에 따른 평균, 최대 응답 시간을 측정하여 성능 저하 지점을 확인합니다.
-   **고가용성 (High Availability) 검증**: 시스템의 일부에 장애가 발생했을 때 전체 서비스가 중단되는 지점, 즉 **SPOF(Single Point of Failure)**가 있는지 확인합니다. 서버/DB 이중화, 서킷 브레이커 패턴 등을 통해 SPOF를 제거해야 합니다.

#### 부하 테스트의 종류

-   **Load Test**: **예상되는 일반적인 부하**를 처리할 수 있는지 확인합니다.
-   **Endurance Test**: **장시간 동안 부하**를 가하여 메모리 누수(Memory Leak), DB 커넥션 풀 고갈 등 숨겨진 문제를 찾아냅니다.
-   **Stress Test**: 부하를 **점진적으로 한계점 이상으로 증가**시켜 시스템이 어떻게 실패하는지, 그리고 얼마나 잘 복구되는지 평가합니다.
-   **Peak Test**: 선착순 이벤트처럼 **짧은 순간에 폭발적인 트래픽**이 발생하는 상황을 시뮬레이션하여 내성을 점검합니다.

#### 부하 테스트 도구

**k6**, **JMeter**, **nGrinder**와 같은 도구를 사용하여 시나리오를 작성하고 실행합니다. 이때 데드락(Deadlock) 같은 병목 지점이나, 연산이 무거운 API의 슬로우 쿼리(Slow Query)를 유발하는 시나리오를 반드시 포함해야 합니다.

---

안정적인 서비스는 우연히 만들어지지 않습니다. 견고한 모니터링 체계를 구축하고, 꾸준한 부하 테스트를 통해 시스템의 한계를 파악하려는 노력이 뒷받침될 때 비로소 신뢰할 수 있는 서비스를 만들 수 있습니다.